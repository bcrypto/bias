\hiddensection{Утверждения аутентификации}\label{CLAIMS.Auth}

\subsection{Утверждение \lstinline{iss}}\label{CLAIMS.Iss}

Утверждение \lstinline{iss} содержит идентификатор СИ, выпустившей БА.
%
Утверждение должно включаться в БА.

Утверждение \lstinline{iss} может включаться в ответ с узла UserInfo.
В этом случае утверждение содержит идентификатор СР, выпустившего ответ.
%
Утверждение следует включать в ответ, если ответ подписывается.

В качестве идентификатора \lstinline{iss} должен использоваться сетевой адрес 
(URI). 
%
Адрес не должен содержать компоненты \lstinline{query} и \lstinline{fragment}.
%
В адресе должна использоваться схема \lstinline{https}.

\subsection{Утверждение \lstinline{sub}}\label{CLAIMS.Sub}

Утверждение \lstinline{sub} содержит идентификатор пользователя, 
прошедшего аутентификацию.
%
Утверждение должно включаться в БА.

Утверждение \lstinline{sub} должно включаться в ответ с узла UserInfo.
%
В этом случае утверждение содержит идентификатор пользователя, которого 
касается ответ.

В качестве идентификатора \lstinline{sub} должна использоваться строка,
чувствительная к регистру. Строка должна умещаться в буфер из 255 октет.
%
СИ должна назначать пользователям уникальные идентификаторы (по их запросу или 
по согласованию с ними). СИ не должна переназначать идентификаторы.

\begin{note*}
Пара идентификаторов \lstinline{sub} и \lstinline{iss} может использоваться
в роли глобального идентификатора пользователя. Этот идентификатор 
остается уникальным в инфраструктуре с несколькими СИ.
%
Для сравнения, идентификация через утверждения \lstinline{email} или
\lstinline{phone_number} не обеспечивает уникальность, поскольку разные СИ могут
использовать один и тот же адрес электронной почты или номер телефона
пользователя.
\end{note*}

\subsection{Утверждение \lstinline{aud}}\label{CLAIMS.Aud}

Утверждение \lstinline{aud} описывает аудиторию БА~--- перечень сторон,
которым билет предназначен. Утверждение должно включаться в БА.

Утверждение \lstinline{aud} может включаться в ответ с узла UserInfo.
В этом случае утверждение описывает аудиторию ответа.
%
Утверждение следует включать в ответ, если ответ подписывается.

Аудитория должна задаваться строкой, чувствительной к регистру, 
или массивом таких строк. Каждая строка содержит идентификатор отдельной 
стороны аудитории.

Утверждение \lstinline{aud} в БА должно включать идентификатор ПС,
инициировавшей выпуск билета. 
%
В ответе с узла UserInfo в \lstinline{aud} следует указать идентификатор ПС, 
которая предоставила БД.
%
В качестве идентификатора ПС должен использоваться параметр 
\lstinline{client_id} запроса авторизации/аутентификации.

\subsection{Утверждение \lstinline{exp}}\label{CLAIMS.Exp}

Утверждение \lstinline{exp} описывает время окончания действия БА.
Утверждение должно включаться в БА.

При достижении времени, указанного в \lstinline{exp}, БА должен быть признан
действительным. Для учета возможных задержек передачи данных или
рассинхронизации таймеров признание БА недействительным может выполняться с
небольшой задержкой, как правило, не более чем несколько минут.

Время обработки данного параметра должно предшествовать времени, 
приведенному в значении параметра. Для учета возможных задержек передачи 
данных или рассинхронизации часов, средство, реализующее обработку данного 
параметра, может допускать небольшое отклонение при сравнении значений времени, 
как правило, не более чем на несколько минут.

Время окончания действия должно задаваться в секундах, которые прошли, начиная с
полуночи 1 января 1970~г. по Гринвичу. Время должно быть представлено числом
JSON.

\subsection{Утверждение \lstinline{iat}}\label{CLAIMS.Iat}

Утверждение \lstinline{iat} описывает момент выпуска БА.
Утверждение должно включаться в БА.

Момент выпуска должно задаваться в секундах, которые прошли, начиная с полуночи
1 января 1970~г. по Гринвичу. Момент должен быть представлен числом JSON.

\subsection{Утверждение \lstinline{auth_time}}\label{CLAIMS.AuthTime}

Утверждение \lstinline{auth_time} описывает момент аутентификации пользователя, 
которого касается БА. Утверждение должно включаться в БА, если параметр 
\lstinline{max_age} (см.~\ref{PARAMS.MaxAge}) включен в запрос 
авторизации/аутентификации или если утверждение \lstinline{auth_time} 
объявлено в запросе существенным (см.~\ref{CLAIMS.ReqWithClaims}).
%
Утверждение может включаться в БА, даже если данные условия не выполняются.

Момент аутентификации должен задаваться в секундах, которые прошли, 
начиная с полуночи 1 января 1970 года по Гринвичу. Момент должен быть 
представлен числом JSON. 

\subsection{Утверждение \lstinline{nonce}}\label{CLAIMS.Nonce}

Утверждение \lstinline{nonce} содержит синхропосылку, указанную в 
одноименном параметре запроса авторизации/аутентификации 
(см.~\ref{PARAMS.Nonce}).
%
Утверждение должно включаться в БА, если оно включено в запрос.
%
Синхропосылка из запроса должна быть повторена в билете.

% todo: Authorization Servers SHOULD perform no other processing on nonce 
% values used.  

\subsection{Утверждение \lstinline{acr}}\label{CLAIMS.Acr}

Утверждение \lstinline{acr} описывает достигнутый уровень гарантий 
аутентификации. 
%
Утверждение может включаться в БА.

Рекомендуется описывать уровень гарантий по правилам, описанным 
в~\ref{PARAMS.AcrValues}.

\subsection{Утверждение \lstinline{amr}}\label{CLAIMS.Amr}

Утверждение \lstinline{amr} содержит перечень использованных методов
аутентификации. Под методами понимаются токены и протоколы аутентификации.
%
Утверждение может включаться в БА.

Перечень \lstinline{amr} должен представлять собой массив строк,
чувствительных к регистру. Строка кодирует тип ТА или название протокола.
%
Правила кодирования определяются за пределами настоящего стандарта.

\subsection{Утверждение \lstinline{azp}}\label{CLAIMS.Azp}

Утверждение \lstinline{azp} содержит идентификатор ПС, инициировавшей выпуск 
БА. Утверждение может включаться в БА.

В качестве идентификатора ПС должен использоваться параметр 
\lstinline{client_id} запроса авторизации/аутентификации.

Утверждение \lstinline{azp} полезно использовать тогда, когда 
в утверждении \lstinline{aud} БА указан только один идентификатор,
и это не идентификатор ПС.

Утверждение \lstinline{azp} может включаться в БА, даже если оно дублирует 
утверждение \lstinline{aud}.

% todo: The azp value is a case sensitive string containing a StringOrURI value.
% REM: Cм. пример совместного использования \lstinline{aud} и \lstinline{azp} на
% https://developers.google.com/identity/protocols/CrossClientAuth#androidIdTokens

\subsection{Утверждение \lstinline{jti}}\label{CLAIMS.Jti}

Утверждение \lstinline{jti} содержит уникальный идентификатор БА.
Утверждение может включаться в БА для предотвращения его повторного использования.

В качестве идентификатора \lstinline{jti} должна использоваться строка, 
чувствительная к регистру. Идентификаторы не должны повторяться.

\subsection{Утверждение \lstinline{at_hash}}\label{CLAIMS.AtHash}

Утверждение \lstinline{at_hash} содержит половину хэш-значения БД, который 
выпускается вместе с БА. Утверждение связывает БД с БА. Утверждение может 
включаться в БА.
%
Утверждение \lstinline{at_hash} должно включаться в БА, если данный билет 
возвращается в ответе с узла Authorization вместе с БД (коммуникационные 
схемы Implicit и Hybrid).

БД должен хэшироваться с помощью алгоритма, указанного в параметре
\lstinline{alg} заголовка БА. Вторая (правая) половина хэш-значения 
должна отбрасываться. Оставшаяся часть должна кодироваться по правилам 
base64url~\cite{RFC4648}, полученный код должен помещаться в 
\lstinline{at_hash}.

