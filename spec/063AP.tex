% Authentication Protocols
\section{Протоколы аутентификации (ПА)}\label{AP}

\subsection{Обзор}\label{AP.Intro}

Пакет ПА устанавливает требования к протоколам аутентификации,
которые выполняются между пользователем и СИ и подтверждают владение
пользователем зарегистрированными ТА.

Технически, в ходе выполнения протокола пользователь по запросу 
СИ активирует токен и предъявляет СИ аутентификатор, который доказывают 
владение им. При формировании аутентификатора может учитываться запрос СИ. 
СИ проверяет аутентификатор, используя выпущенный при регистрации токена 
аттестат.
%
В сеансе протокола может использоваться не один, а несколько токенов и 
соответственно аутентификаторов.

При выборе или проектировании протокола аутентификации следует учитывать 
возможные атаки. Некоторые из них описаны в пункте~\ref{ATK.AP}. 

Одним из инструментов защиты от атак является контроль числа попыток 
аутентификации, которое может выполнить противник в течение определенного 
времени. Для организации контроля СИ может блокировать аутентификацию на 
определенное время после определенного числа неверных попыток. Интервал 
блокировки может быть постоянным или растущим вплоть до удачной попытки. 

СИ может использовать следующие дополнительные методы контроля числа
попыток аутентификации:
\begin{enumerate}
\item
После очередной неверной попытки пользователь должен проходить антибот-тест 
вплоть до верной попытки. Антибот-тест позволяет отличить человека от 
программы (бота). В англоязычной литературе тест известен под 
аббревиатурой CAPTCHA (Completely Automated Public Turing test to tell 
Computers and Humans Apart). 

\item
Сетевые адреса, с которых предпринимается много неверных попыток 
аутентификации, блокируются. Пользователю разрешается проходить аутентификацию 
только с определенных адресов.

\item
Запоминаются шаблоны поведения пользователя или его операционная среда. 
Пресекаются попытки, не соответствующие шаблонам или среде.
\end{enumerate}

Протокол со стороны СИ может выполнять терминал. Эта ситуация во всех  
требованиях пакета подразумевается, хотя оговаривается явно только в 
требованиях~\ref{R.AP.Term}, \ref{R.AP.Term2}. 

\subsection{Требования}\label{AP.Reqs}

\req{ПА}{1--3}\label{Req.AP.Attempts}
Если энтропия аутентификатора меньше 64 битов, то
СИ должен организовать защиту от его подбора противником.
Защита должна быть построена так, чтобы за 30 дней противник 
не мог выполнить более 100 попыток аутентификации.

\req{ПА}{1--3}
Обмен данными протокола, от конфиденциальности, целостности и подлинности 
которых зависят гарантии аутентификации, должен выполняться по защищенному 
соединению (с аутентификацией СИ).

\begin{note*}
Соединение может создаваться в ходе выполнения протокола, и тогда
первые его сообщения, отвечающие за создание соединения или обмен открытыми 
данными, могут не быть защищены или для них может не обеспечиваться 
конфиденциальность.
\end{note*}

% todo: аутентификация -- защита от атаки <<противник посередине>>?

\req{ПА}{3}
Открытые данные, по которым можно получить информацию об идентификационных 
атрибутах пользователя, должны передаваться по защищенному соединению.

% todo: в том числе сертификаты открытых ключей

\req{ПА}{2,~3}
При создании защищенного соединения должны использоваться волатильные данные,
которые делают сообщения сеанса протокола контекстнозависимыми и препятствуют 
принятию сообщений одного сеанса в другом.

% todo: защита от атак повтора?
% todo: только волатильные данные СИ/терминала имеют значение?

\req{ПА}{2,~3} 
Не должны использоваться протоколы аутентификации, стойкость
которых снижается при определенных настройках, которые согласуются между
пользователем и СИ в начале выполнения протокола.

% todo: 1--3?

\req{ПА}{1--3}\label{R.AP.Term}
Если аутентификацию по поручению СИ выполняет терминал, то соединение между СИ 
и терминалом должно быть защищено (с взаимной аутентификацией сторон).

\req{ПА}{1--3}\label{R.AP.Term2}
По данным, которые СИ передает терминалам, должно быть вычислительно трудно 
определить секрет аутентификации пользователя. 

\begin{note*}
Терминалам может передаваться сертификат открытого ключа пользователя
и тогда в ходе аутентификации терминал проверяет, что пользователь 
знает соответствующий личный ключ. Терминалам не должны передаваться 
секретные аттестаты с хэш-значениями паролей, ключами OTP-токенов, картами 
секретов или ключами для их генерации.
\end{note*}

% todo: Verifier-Compromise Resistance?
% нужно ли об этом говорить отдельно, ведь требования по защите секретов 
% аутентификации уже даны?

% todo: 
% Требование ДК.7 (1–4). Если ключи защиты [ДК.6] формируются на основании 
% пароля удаленного оператора, то этот пароль должно быть вычислительно трудно 
% определить по данным обмена между оператором и СКЗИ. 
%
% Требование ДК.8 (3, 4). Ключи защиты [ДК.6] должны формироваться так, чтобы 
% их было вычислительно трудно определить даже после раскрытия долговременных 
% ключей и паролей удаленного оператора. 
%
% Требование ДК.9 (4). Ключи защиты [ДК.6] должны формироваться так, чтобы их 
% было вычислительно трудно определить даже после раскрытия долговременных ключей 
% СКЗИ.
