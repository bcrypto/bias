\section{Схема~Code}\label{OIDC.Code}

Взаимодействие сторон по схеме~Code выполняется следующим образом:

\begin{enumerate}
\item 
В сеансе работы с пользователем ПС готовит запрос авторизации / аутентификации.

\item 
ПС пересылает запрос КП пользователя, перенаправляя КП на узел Authorization.

\item 
СИ получает запрос, аутентифицирует пользователя, получает согласие пользователя
на доступ ПС к ресурсам, указанным в запросе.

\item 
В случае успешной аутентификации и согласия пользователя СИ создает и сохраняет
билеты аутентификации, доступа и возможно обновления. СИ также генерирует и
сохраняет код авторизации, ссылающийся на билеты.

\item 
СИ перенаправляет КП на узел Redirection вместе с кодом авторизации.
 
\item 
ПС отправляет код авторизации на узел Token, ожидая в ответ билеты. 

\item 
СИ аутентифицирует ПС, проверяет код авторизации, определяет соответствующие ему
билеты и отправляет их СИ.

\item 
ПС извлекает из БА утверждения об аутентификации и о пользователе. Эти
утверждения ПС использует для организации цифровых услуг.

\item 
ПС использует БД для доступа к ресурсам пользователя,
обращаясь к узлу UserInfo или к другим узлам ресурсов. 

\item 
Располагая БО, ПС получает новый БД без повторного прогона схемы 
\addendum{Code}. Для этого ПС обращается к узлу Token, включая в запрос БО.
\end{enumerate}

Если в схеме Code используется БО, то этот билет, как правило, 
имеет большой (несколько месяцев) или даже неограниченный срок действия,
а БД~--- малый (в пределах 1~\addendum{ч}). 
%
Если БО не используется, то БД имеет большой или неограниченный срок 
действия. 
%
Билеты с неограниченным сроком действия могут использоваться сколь 
угодно долго, пока пользователь не отзовет их.

Перед взаимодействием по схем\addendum{е Code} ПС должна быть аутентифицирована перед~СИ с 
использованием протокола, установленного для данной ПС при ее регистрации 
перед~СИ.
