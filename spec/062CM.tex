% Credential Management
\section{Управление аттестатами (УА)}\label{CM}

\subsection{Обзор}\label{CM.Intro}

Пакет УА устанавливает требования по управлению аттестатами.
Требования касаются вопросов выпуска аттестатов в процессе регистрации ТА,
хранения аттестатов, перевыпуска аттестатов и токенов, их отзыва и вывода из
обращения.

Аттестат представляет собой учетную запись пользователя, которая связывает
его идентификатор, другие идентификационные данные, с зарегистрированными ТА.
%
Пользователь регистрирует либо собственный токен (например, статический пароль), 
либо токен, выпущенный СИ или другой стороной. 
%
Посредником при регистрации может быть РЦ. Рекомендуется регистрировать 
несколько токенов, чтобы можно было сохранить доступ к учетной записи при 
утрате одного из них.

%Связывание ТА с аттестатом может быть слабым и сильным. При сильном связывании 
%целостность аттестата контролируется (например, с помощью ЭЦП), при слабом~--- нет.

Аттестаты бывают двух типов: открытые, которые можно раскрывать, и 
секретные, которые раскрывать нельзя. 
%
Примером открытого аттестата является сертификат открытого ключа, примером 
секретного~--- структура данных, которая состоит из идентификатора 
(логин) пользователя и хэш-значения его пароля или секретного ключа его 
ОTP-токена.
%
Аттестат с хэш-значением пароля классифицируется как секретный, потому что 
хэш-значение содержит информацию о пароле и дает возможность его определить
через перебор.
%
СИ обязательно хранит секретные аттестаты и возможно хранит открытые.

%В некоторых случаях СИ может быть разделена на две службы. Первая
%непосредственно аутентифицирует пользователя, проверяя его аутентификаторы. 
%Вторая хранит аттестаты и предоставляет первой службе результаты проверки 
%аутентификаторов. 
%
%В настоящем стандарте разделение СИ на части не предполагается и поэтому
%требования к сервисам проверки не выдвигаются.

СИ может перевыпускать токены и соответствующие аттестаты. Обычной причиной
перевыпуска является истечение срока действия. Перевыпуск может быть также
инициирован запросом пользователя. При перевыпуске может потребоваться
перерегистрация пользователя с участием РЦ. СИ может предусматривать переходный
период, когда действуют и старые аттестаты, и новые.

СИ отвечает за отзыв аттестатов и токенов, за вывод их из эксплуатации по 
окончании жизненного цикла. 
%
СИ очищает записи в базе данных секретных аттестатов и поддерживает список 
отзыва открытых аттестатов.
%
СИ может принимать аппаратные токены и очищать их.

СИ ведет аудит событий, связанных с управлением аттестатами и токенами. 
События касаются перечисленных выше процессов.

\subsection{Требования}\label{CM.Reqs}

%\req{УА}{1--3}
%При построении секретов аутентификации
%СИ должна использовать генератор случайных чисел,
%который удовлетворяет требованиям СТБ~34.101.27 (пакет СЧ).

\req{УА}{1--3}
Доступ к секретным аттестатам должен быть ограничен.
Доступ должны иметь только администраторы и сервисы СИ,
которым этот доступ необходим. 

\req{УА}{1}
Секреты аутентификации в составе аттестатов не должны храниться в открытом виде. 
Должны храниться их хэш-значения или использоваться методы защиты 
высших уровней.

\req{УА}{2}
Секреты аутентификации в составе аттестатов не должны храниться в открытом виде. 
Должны использоваться методы защиты из следующего списка:
\begin{itemize}
\item
вместо секрета хранится ключ, который строится по секрету с помощью 
алгоритма PBKDF2, определенного в СТБ~34.101.45, 
или схожего криптографического механизма.
%
В PBKDF2 число итераций должно быть не меньше 10000,
битовая длина синхропосылки~--- не меньше 64.

\item
секрет хранится в зашифрованном виде. Расшифрование 
выполняется в процессе аутентификации;

\item
методы защиты высших уровней.
\end{itemize}

\req{УА}{3}
Секреты аутентификации в составе аттестатов не должны храниться в открытом 
виде. Должны использоваться методы защиты из следующего списка:
\begin{itemize}
\item
секреты зашифровываются на ключе данных. Ключ данных, в свою очередь, 
зашифровывается на мастер-ключе, сохраняется вместе с данными
и расшифровывается только в процессе аутентификации.
%
Шифрование на мастер-ключе выполняется с помощью СКЗИ, удовлетворяющего 
требованиям СТБ~34.101.27;

\item
секреты хранятся в пределах криптографической границы аппаратного
СКЗИ, удовлетворяющего требованиям СТБ~34.101.27 (уровни 3, 4).
\end{itemize}

% todo: OPRF?

\req{УА}{2,~3}
СИ должна разработать и ввести политику перевыпуска аттестатов и токенов.
Для перевыпуска действующего токена пользователь должен 
подтвердить владение им. По истечении срока действия
использование старых токенов и аттестатов должно быть запрещено. 
Новые статические пароли должны отличаться от старых. 
Соединение, которое используется при перевыпуске, должно быть защищено 
(с аутентификацией СИ). 

% todo: Должны запрещаться пароли по умолчанию?
% todo: с взаимной аутентификацией?

% \req{УА}{3}
% Перевыпуск действующего токена должен проходить только по истечении срока 
% его действия. Для подтверждения владения токеном пользователь должен пройти 
% аутентификацию.

% todo: включить?

\req{УА}{2,~3}
СИ должна приостанавливать действие токенов немедленно после 
уведомления от владельца о компрометации (пропаже или краже).

\begin{note*}
При приеме уведомления СИ следует провести аутентификацию пользователя.
%
Если в результате расследования уведомления выяснится, что оно является 
ложным, то действие токенов может быть возобновлено.
\end{note*}

% todo: немедленно?
% todo: следует провести -> необходимо провести?

\req{УА}{2}
СИ должна аннулировать токены и аттестаты в течение 72~\addendum{ч} 
после уведомления о том, что аттестат перестал действовать 
или токен скомпрометирован (при условии справедливости уведомления).

\req{УА}{3}
СИ должна аннулировать токены и аттестаты в течение 24~\addendum{ч} 
после уведомления о том, что аттестат перестал действовать 
или токен скомпрометирован (при условии справедливости уведомления). 

\req{УА}{2,~3}
СИ должна вести аудит событий, связанных с регистрацией, использованием, 
перевыпуском, выводом из эксплуатации токенов и аттестатов.  

%The record created by the CSP SHALL contain the date and time the authenticator 
%was bound to the account. The record SHOULD include information about the 
%source of the binding (e.g., IP address, device identifier) of any device 
%associated with the enrollment. If available, the record SHOULD also contain 
%information about the source of unsuccessful authentications attempted with the 
%authenticator.

\req{УА}{2}
СИ должна хранить записи аудита в течение не менее 7 лет и 6~месяцев после 
вывода аттестата из эксплуатации.  

\req{УА}{3}
СИ должна хранить записи аудита в течение не менее 10 лет и 6 месяцев 
после вывода аттестата из эксплуатации.  
