% Credential Management
\section{Управление аттестатами (УА)}\label{CM}

\subsection{Обзор}\label{CM.Intro}

Пакет УА устанавливает требования по управлению аттестатами.
Требования касаются вопросов выпуска аттестатов в процессе регистрации ТА,
хранения аттестатов, перевыпуска аттестатов и токенов, их отзыва и вывода из
обращения.

Аттестат представляет собой учетную запись пользователя, которая связывает
его идентификатор, другие идентификационные данные, с зарегистрированными ТА.
%
Пользователь регистрирует либо собственный токен (например, статический пароль), 
либо токен, выпущенный СИ или другой стороной. 
%
Посредником при регистрации может быть РЦ. Рекомендуется регистрировать 
несколько токенов, чтобы можно было сохранить доступ к учетной записи при 
утрате одного из них.

%Связывание ТА с аттестатом может быть слабым и сильным. При сильном связывании 
%целостность аттестата контролируется (например, с помощью ЭЦП), при слабом~--- нет.

Аттестаты бывают двух типов: открытые, которые можно раскрывать, и 
секретные, которые раскрывать нельзя. 
%
Примером открытого аттестата является сертификат открытого ключа, примером 
секретного~--- структура данных, которая состоит из идентификатора 
(логин) пользователя и хэш-значения его пароля или секретного ключа его 
ОTP-токена.
%
СИ обязательно хранит секретные аттестаты и возможно хранит открытые.

\addendum{
Аттестат с хэш-значением пароля классифицируется как секретный, потому что 
хэш-значение содержит информацию о пароле и дает возможность его определить
через перебор.
%
Для усложнения перебора используются два дополнительных механизма.
%
Во-первых, вместе с паролем хэшируется волатильная синхропосылка, часто 
называемая <<солью>>. Зависимость хэш-значений от синхропосылок препятствует 
упрощению перебора за счет предварительных вычислений.
%
Во-вторых, алгоритм хэширования искусственно усложняется. Например, вместо одной
выполняется несколько итераций хэширования, или в процессе хэширования 
используется память нерационально большого объема.
%
Большая вычислительная сложность алгоритма хэширования навязывает высокую 
сложность перебора.
%
В определенных случаях хэш-значения паролей могут использоваться как ключи,
и тогда вместо алгоритмов хэширования речь идет об алгоритмах построения 
ключа. 
%
Алгоритм PBKDF2, определенный в СТБ 34.101.45, является примером алгоритма
последнего типа. Сложность PBKDF2 определяется числом внутренних итераций,
которое может регулироваться.}

%В некоторых случаях СИ может быть разделена на две службы. Первая
%непосредственно аутентифицирует пользователя, проверяя его аутентификаторы. 
%Вторая хранит аттестаты и предоставляет первой службе результаты проверки 
%аутентификаторов. 
%
%В настоящем стандарте разделение СИ на части не предполагается и поэтому
%требования к сервисам проверки не выдвигаются.

СИ может перевыпускать токены и соответствующие аттестаты. Обычной причиной
перевыпуска является истечение срока действия. Перевыпуск может быть также
инициирован запросом пользователя. При перевыпуске может потребоваться
перерегистрация пользователя с участием РЦ. СИ может предусматривать переходный
период, когда действуют и старые аттестаты, и новые.

СИ отвечает за отзыв аттестатов и токенов, за вывод их из эксплуатации по 
окончании жизненного цикла. 
%
СИ очищает записи в базе данных секретных аттестатов и поддерживает список 
отзыва открытых аттестатов.

СИ ведет аудит событий, связанных с управлением аттестатами и токенами. 
События касаются перечисленных выше процессов.

\subsection{Требования}\label{CM.Reqs}

\req{УА}{1--3}
Доступ к секретным аттестатам должен быть ограничен.
Доступ должны иметь только администраторы и сервисы СИ,
которым этот доступ необходим. 

\req{УА}{\addendum{1,} 2}
Секреты аутентификации в составе аттестатов не должны храниться в открытом 
виде. 
%
\addendum{Для защиты секретов должны использоваться СКЗИ, удовлетворяющие 
требованиям СТБ 34.101.27 (уровни 2--4)}.
%
\addendum{Статический пароль либо должен защищаться с помощью СКЗИ, 
либо вместо него должны храниться хэш-значение или ключ, 
полученные с помощью алгоритма контролируемо большой вычислительной 
сложности. В алгоритме должны использоваться синхропосылки, 
битовая длина которых не меньше 64. Если используется алгоритм PBKDF2,
то число итераций в нем должно быть не меньше 10000.}

\req{УА}{3}
Секреты аутентификации в составе аттестатов не должны храниться в открытом 
виде. \addendum{Для защиты секретов должны использоваться СКЗИ, удовлетворяющие 
требованиям СТБ 34.101.27 (уровни 2--4)}.

% todo: OPRF?

\req{УА}{2,~3}
СИ должна разработать и ввести политику перевыпуска аттестатов и токенов.
Для перевыпуска действующего токена пользователь должен 
подтвердить владение им. По истечении срока действия
использование старых токенов и аттестатов должно быть запрещено. 
Новые статические пароли должны отличаться от старых. 
Соединение, которое используется при перевыпуске, должно быть защищено 
(с аутентификацией СИ). 

% todo: Должны запрещаться пароли по умолчанию?
% todo: с взаимной аутентификацией?

% \req{УА}{3}
% Перевыпуск действующего токена должен проходить только по истечении срока 
% его действия. Для подтверждения владения токеном пользователь должен пройти 
% аутентификацию.

% todo: включить?

\req{УА}{2,~3}
СИ должна приостанавливать действие токенов немедленно после 
уведомления от владельца о компрометации (пропаже или краже).
%
\addendum{СИ должна регистрировать уведомления и расследовать их.
%
Если в результате расследования уведомления выясняется, что оно является 
ложным, то действие токенов должно быть возобновлено.}

\begin{note*}
При приеме уведомления СИ следует провести аутентификацию пользователя
\addendum{
с помощью сохранившихся (нескомпрометрированных) ТА, согласованных при 
регистрации. 
%
Уровень гарантий аутентификации при приеме уведомления может быть ниже, 
чем в обычной ситуации.}
\end{note*}

% todo: немедленно?

\req{УА}{2}
СИ должна аннулировать токены и аттестаты в течение 72~\addendum{ч} 
после уведомления о том, что аттестат перестал действовать 
или токен скомпрометирован (при условии справедливости уведомления).

\req{УА}{3}
СИ должна аннулировать токены и аттестаты в течение 24~\addendum{ч} 
после уведомления о том, что аттестат перестал действовать 
или токен скомпрометирован (при условии справедливости уведомления). 

\req{УА}{2,~3}
СИ должна вести аудит событий, связанных с регистрацией, использованием, 
перевыпуском, выводом из эксплуатации токенов и аттестатов.  

%The record created by the CSP SHALL contain the date and time the authenticator 
%was bound to the account. The record SHOULD include information about the 
%source of the binding (e.g., IP address, device identifier) of any device 
%associated with the enrollment. If available, the record SHOULD also contain 
%information about the source of unsuccessful authentications attempted with the 
%authenticator.

\req{УА}{2}
СИ должна хранить записи аудита в течение не менее 7 лет и 6~месяцев после 
вывода аттестата из эксплуатации.  

\req{УА}{3}
СИ должна хранить записи аудита в течение не менее 10 лет и 6 месяцев 
после вывода аттестата из эксплуатации.  
